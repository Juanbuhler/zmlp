# syntax = docker/dockerfile:experimental
FROM zmlp/py3-client:latest
ENV DEBIAN_FRONTEND=noninteractive

RUN apt-get update && apt-get -y upgrade && apt-get -y install \
    libjpeg-turbo8-dev \
    libpng-dev \
    libraw-dev \
    libtiff-dev \
    libpugixml-dev \
    libhdf5-dev \
    libwebp-dev \
    libgif-dev \
    libilmbase24 \
    openimageio-tools \
    xz-utils \
    libglib2.0-0 \
    exiftool \
    mediainfo \
    imagemagick \
    poppler-utils

RUN mkdir /build
COPY ./ /build
WORKDIR /build
RUN pip3 install .

ARG ffmver=4.3.1-amd64
COPY ffmpeg-amd64-static.tar.xz .
RUN tar -xJf ffmpeg-amd64-static.tar.xz
RUN cp ffmpeg-$ffmver-static/ffmpeg /usr/bin
RUN cp ffmpeg-$ffmver-static/ffprobe /usr/bin
RUN rm -rf ffmpeg*

WORKDIR /zps

RUN rm -rf /build
