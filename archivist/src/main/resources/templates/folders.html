<!DOCTYPE html>
<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorator="layout" xmlns:th="http://www.thymeleaf.org">
<head>

</head>
<body>

<section layout:fragment="content">
    <div th:include="fragments/folders :: menu"/>
    <div class="wrapper">
    <div class="container-fluid">
        <div class="row">
            <div id="leftContent" class="col-md-12" style="padding:0px">
                <table id="table" class="table table-striped table-hover">
                    <thead>
                    <tr>
                        <th></th>
                        <th>Name</th>
                        <th>Owner</th>
                        <th>Date</th>
                        <th>Assets</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:id="${'row_' + child.id}" class="clickable-row" th:attr="data-href=${'/admin/gui/folders/' + child.id}" th:each="child: ${children}">
                        <td width="1">
                            <i th:if="${child.dyhiRoot == false &amp;&amp; child.dyhiId == null}" class="fa fa-folder fa-fw fa-lg" style="color: #666"/>
                            <i th:if="${child.dyhiRoot == false &amp;&amp; child.dyhiId != null}" class="fa fa-folder fa-fw fa-lg text-danger"/>
                            <i th:if="${child.dyhiRoot} == true" class="fa fa-flash fa-fw fa-lg" style="color: #333"/>

                        </td>
                        <td class="vert-align col-xs-6" th:text="${child.name}"/>
                        <td class="vert-align" th:text="${child.user.username}"></td>
                        <td class="vert-align" th:text="${#dates.format(child.timeCreated, 'dd MMM yyyy')}"></td>
                        <td class="td-asset-count"><i class="fa fa-spinner fa-spin fa-fw"></i></td>
                    </tr>
                    </tbody>
                </table>
            </div>

            <div id="rightContent" class="hidden" style="padding-left: 15px; padding-right: 0px;">
                <br/>
                <div class="panel">
                    <div class="panel-header"><h4>Folder</h4></div>
                    <div class="panel-body">

                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>
    <div id="contextMenu" class="dropdown clearfix">
        <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu" style="display:block;position:static;margin-bottom:5px;">
            <li><a tabindex="-1" href="#">First action</a></li>
            <li><a tabindex="-1" href="#">Another action</a></li>
            <li><a tabindex="-1" href="#">Something else here</a></li>
            <li class="divider"></li>
            <li><a tabindex="-1" href="#">Separated link</a></li>
        </ul>
    </div>

    <div th:include="fragments/dyhi :: modal_create"/>
    <div th:include="fragments/folders :: modal_create"/>
    <div th:include="fragments/table :: clickable"/>
    <div th:include="fragments/table :: context_menu"/>
    <script th:inline="javascript" type="text/javascript">
        //<![CDATA[
        $(function() {

            $(".td-asset-count").each(function(index) {
                var folderId = $(this).parent().attr("id").split("_")[1];
                $.ajax({
                    type: 'GET',
                    url: '/api/v1/folders/' + folderId + "/_assetCount",
                    dataType: 'json',
                    contentType: "application/json",
                    column: $(this),
                    success: function(result) {
                        console.log(result["count"]);
                        this.column.text(result["count"]);
                    }
                });
            });


            var panel = $('#rightContent');
            var table = $('#leftContent');

            function open() {
                panel.removeClass('hidden').addClass('col-md-3');
                table.removeClass('col-md-12').addClass("col-md-9");
            }

            function close() {
                panel.addClass('hidden').removeClass('col-md-3');
                table.removeClass('col-md-9').addClass("col-md-12")
            }

            $('#opener').on('click', function() {
                if (panel.hasClass("hidden")) {
                    open();
                } else {
                    close();
                }
                return false;
            });
        });
        //]]>
    </script>
</section>
</body>
</html>

